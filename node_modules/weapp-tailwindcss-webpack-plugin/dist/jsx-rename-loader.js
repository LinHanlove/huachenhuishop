'use strict';

var loaderUtils = require('loader-utils');
var parser = require('@babel/parser');
var traverse = require('@babel/traverse');
var generate = require('@babel/generator');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var traverse__default = /*#__PURE__*/_interopDefaultLegacy(traverse);
var generate__default = /*#__PURE__*/_interopDefaultLegacy(generate);

function jsxHandler(rawSource, replacer) {
    const ast = parser.parse(rawSource, {
        sourceType: 'unambiguous'
    });
    traverse__default["default"](ast, {
        enter(path) {
            replacer(path);
        },
        noScope: true
    });
    return generate__default["default"](ast);
}

function loader(content) {
    this.cacheable && this.cacheable();
    const config = loaderUtils.getOptions(this);
    config.replacer.end();
    const { code } = jsxHandler(content, config.replacer);
    return code;
}

module.exports = loader;
